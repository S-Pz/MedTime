generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id_usuario  Int   @id @default(autoincrement())
  cpf         String @unique
  nome        String
  senha       String

  paciente    Paciente?
  funcionario Funcionario?
}

model Paciente {
  id_usuario  Int  @id
  endereco    String?
  telefone    String?

  usuario Usuario @relation(fields: [id_usuario], references: [id_usuario])
  agenda_consulta AgendaConsulta[]
}

model Funcionario {
  id_usuario Int @id
  id_unidade Int
  is_admin   Boolean?

  usuario Usuario @relation(fields: [id_usuario], references: [id_usuario])
  unidade Unidade @relation(fields: [id_unidade], references: [id_unidade])
}

model Unidade {
  id_unidade    Int   @id @default(autoincrement())
  endereco      String?
  nome          String?

  funcionario   Funcionario[]
  calendario_medico CalendarioMedico[]
}

model CalendarioMedico {
  id_calendario_medico Int      @id @default(autoincrement())
  id_medico            Int
  id_unidade           Int
  dia_semana           DateTime
  horario_inicio       DateTime?
  horario_fim          DateTime?

  medico  Medico  @relation(fields: [id_medico], references: [id_medico])
  unidade Unidade @relation(fields: [id_unidade], references: [id_unidade])
  
  agenda_consulta AgendaConsulta[]
}

model AgendaConsulta {
  id_consulta          Int      @id @default(autoincrement())
  id_usuario           Int
  id_calendario_medico Int
  status               String?
  tempo_consulta       DateTime?

  paciente          Paciente          @relation(fields: [id_usuario], references: [id_usuario])
  calendario_medico CalendarioMedico @relation(fields: [id_calendario_medico], references: [id_calendario_medico])
}

model Medico {
  id_medico      Int    @id @default(autoincrement())
  crm            Int    @unique
  nome           String
  especialidade  String

  calendario_medico CalendarioMedico[]
}