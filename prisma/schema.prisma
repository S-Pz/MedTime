generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id_usuario  Int   @id @default(autoincrement())
  cpf         String @unique
  nome        String
  email       String @unique
  senha       String

  paciente    Paciente?
  funcionario Funcionario?
}

model Paciente {
  id_usuario  Int  @id
  endereco    String?
  telefone    String?

  ficha_medica FichaMedica?
  
  usuario Usuario @relation(fields: [id_usuario], references: [id_usuario], onDelete: Cascade)
  agenda_consulta AgendaConsulta[]

}

model FichaMedica {
  id_ficha_medica   Int     @id @default(autoincrement())
  id_usuario        Int     @unique 

  tipo_sanguineo      String?  
  data_ultimo_checkup DateTime? 
  altura_m            Float?    
  peso_kg             Float?    
  notas_estilo_vida   String?   @db.Text
  
  contato_emerg_nome  String?
  contato_emerg_fone  String?

  alergias           String[] 
  condicoes_cronicas String[] 
  medicamentos       String[] 
  vacinacoes         String[] 

  paciente Paciente @relation(fields: [id_usuario], references: [id_usuario], onDelete: Cascade)
}

model Funcionario {
  id_usuario Int @id
  id_unidade Int
  is_admin   Boolean?

  usuario Usuario @relation(fields: [id_usuario], references: [id_usuario])
  unidade Unidade @relation(fields: [id_unidade], references: [id_unidade])
}

model Unidade {
  id_unidade    Int   @id @default(autoincrement())
  endereco      String?
  nome          String?

  funcionario   Funcionario[]
  calendario_medico CalendarioMedico[]
}

model CalendarioMedico {
  id_calendario_medico Int      @id @default(autoincrement())
  id_medico            Int
  id_unidade           Int
  dia_semana           DateTime
  horario_inicio       DateTime?
  horario_fim          DateTime?
  disponivel           Boolean  @default(true)
  
  medico  Medico  @relation(fields: [id_medico], references: [id_medico])
  unidade Unidade @relation(fields: [id_unidade], references: [id_unidade])
  
  agenda_consulta AgendaConsulta[]
}

model AgendaConsulta {
  id_consulta          Int      @id @default(autoincrement())
  id_usuario           Int
  id_calendario_medico Int
  status               String?
  tempo_consulta       DateTime?

  paciente          Paciente          @relation(fields: [id_usuario], references: [id_usuario])
  calendario_medico CalendarioMedico @relation(fields: [id_calendario_medico], references: [id_calendario_medico])
}

model Medico {
  id_medico      Int    @id @default(autoincrement())
  crm            Int    @unique
  nome           String
  especialidade  String

  calendario_medico CalendarioMedico[]
}